"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[361],{7585:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Database/transactions","title":"Transactions","description":"gowebutils provides a simple yet powerful way to manage database transactions, ensuring data consistency across multiple operations.","source":"@site/docs/Database/transactions.md","sourceDirName":"Database","slug":"/Database/transactions","permalink":"/gowebutils/docs/Database/transactions","draft":false,"unlisted":false,"editUrl":"https://github.com/gurch101/gowebutils/tree/main/packages/create-docusaurus/templates/shared/docs/Database/transactions.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Query Builder","permalink":"/gowebutils/docs/Database/querybuilder"},"next":{"title":"Database Testing","permalink":"/gowebutils/docs/Database/testing"}}');var s=t(4848),r=t(8453);const i={sidebar_position:4},o="Transactions",c={},l=[{value:"Using Transactions",id:"using-transactions",level:3},{value:"Nested Transactions",id:"nested-transactions",level:3},{value:"Error Handling",id:"error-handling",level:3}];function d(n){const e={code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"transactions",children:"Transactions"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"gowebutils"})," provides a simple yet powerful way to manage database transactions, ensuring data consistency across multiple operations."]}),"\n",(0,s.jsx)(e.h3,{id:"using-transactions",children:"Using Transactions"}),"\n",(0,s.jsx)(e.p,{children:"To execute operations within a transaction, use the app.DB.WithTransaction method. This method wraps your database operations in a transaction and handles commit or rollback automatically based on the result of your callback function."}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-go",children:'err := app.DB.WithTransaction(ctx, func(tx dbutils.DB) error {\n  tenantID, err := dbutils.Insert(ctx, tx, "tenants", map[string]any{\n    "tenant_name":   uuid.New().String(),\n    "contact_email": email,\n    "plan":          "free",\n  })\n\n  if err != nil {\n    return fmt.Errorf("failed to create tenant: %w", err)\n  }\n\n  userID, err = dbutils.Insert(ctx, tx, "users", map[string]any{\n    "tenant_id": tenantID,\n    "user_name": username,\n    "email":     email,\n  })\n\n  if err != nil {\n    return fmt.Errorf("failed to create user: %w", err)\n  }\n\n  // Transaction will be committed if we return nil\n  return nil\n})\n'})}),"\n",(0,s.jsx)(e.h3,{id:"nested-transactions",children:"Nested Transactions"}),"\n",(0,s.jsxs)(e.p,{children:["Transactions can be nested by simply calling ",(0,s.jsx)(e.code,{children:"WithTransaction"})," again within a transaction callback. This is particularly useful when composing functions that each need their own transaction context."]}),"\n",(0,s.jsx)(e.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(e.p,{children:"If your callback function returns an error:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"The transaction will be automatically rolled back"}),"\n",(0,s.jsx)(e.li,{children:"No changes will be committed to the database"}),"\n",(0,s.jsx)(e.li,{children:"The error will be returned from the WithTransaction call"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"This approach simplifies error handling and ensures your database remains in a consistent state even when operations fail."})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>o});var a=t(6540);const s={},r=a.createContext(s);function i(n){const e=a.useContext(r);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),a.createElement(r.Provider,{value:e},n.children)}}}]);